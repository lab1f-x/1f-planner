
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>書き込み式：今日の行動キャパ可視化紙</title>
  <style>
    body {
      background: white;
      font-family: sans-serif;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
    }
    .wrapper {
      max-width: 360px;
      width: 100%;
    }
    .controls {
      margin-bottom: 10px;
      text-align: center;
    }
    .controls button {
      margin: 0 5px;
      padding: 6px 14px;
      font-size: 14px;
      cursor: pointer;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 10px;
    }
    #memo {
      width: 120px;
      height: 80px;
      border: 1px solid #ccc;
      background-color: white;
      box-sizing: border-box;
    }
    #calendar {
      width: 200px;
      border: 1px solid #ccc;
      padding: 4px;
      box-sizing: border-box;
    }
    .cal-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      grid-auto-rows: 16px;
      gap: 2px;
    }
    .cal-cell {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background-color: #ccc;
    }
    .cal-cell.weekend {
      background-color: red;
    }
    .cal-cell.today {
      border-radius: 3px;
      background-color: blue;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(10, 30px);
      grid-template-rows: repeat(8, 30px);
      gap: 2px;
      margin-bottom: 20px;
      border: 1px solid #ccc;
      background: #f4f4f4;
    }
    .cell {
      width: 30px;
      height: 30px;
      border: 1px solid #ddd;
      background-color: white;
    }
    .footer {
      font-size: 10px;
      color: #999;
      text-align: center;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <div class="controls">
      <button id="btnColorful">カラフル表示</button>
      <button id="btnMono">モノクロ表示</button>
      <button onclick="downloadImage()">画像として保存</button>
    </div>

    <div id="capture-area">
      <div class="top-bar">
        <textarea id="memo" placeholder="メモ欄"></textarea>
        <div id="calendar">
          <div class="cal-grid" id="calGrid"></div>
        </div>
      </div>
      <div class="grid" id="grid"></div>
    </div>

    <div class="footer">© 研究棟1f 2025</div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script>
    function downloadImage() {
      const target = document.getElementById("capture-area");
      html2canvas(target, { scale: 2, useCORS: true }).then(canvas => {
        const link = document.createElement('a');
        link.download = 'ichinichi-haibunzu.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
      });
    }

    const gridWidth = 10, gridHeight = 8;
    const totalCells = gridWidth * gridHeight;
    const fillPercentage = Math.floor(Math.random() * 11) + 75;
    const fillTarget = Math.floor((fillPercentage / 100) * totalCells);

    const cells = Array(gridHeight).fill(null).map(() => Array(gridWidth).fill(null));
    const colors = ["#fdecea","#fff4e5","#fffde7","#f1f8e9","#e0f7fa","#e3f2fd","#ede7f6","#fce4ec"];
    let blockId = 1;

    function placeBlock(size) {
      for (let attempts=0; attempts<100; attempts++) {
        const isH = Math.random() < 0.5;
        const w = isH ? size : 1;
        const h = isH ? 1 : size;
        const x = Math.floor(Math.random()*(gridWidth-w+1));
        const y = Math.floor(Math.random()*(gridHeight-h+1));
        let can = true;
        for (let dy=0; dy<h; dy++) {
          for (let dx=0; dx<w; dx++) {
            if (cells[y+dy][x+dx] !== null) { can=false; break; }
          }
          if (!can) break;
        }
        if (can) {
          for (let dy=0; dy<h; dy++) {
            for (let dx=0; dx<w; dx++) {
              cells[y+dy][x+dx] = blockId;
            }
          }
          blockId++;
          return size;
        }
      }
      return 0;
    }

    let filled = 0;
    while (filled < fillTarget) {
      const size = Math.floor(Math.random()*4)+2;
      filled += placeBlock(size);
    }

    const gridElem = document.getElementById('grid');
    const cellDivs = [];
    for (let y=0; y<gridHeight; y++){
      for (let x=0; x<gridWidth; x++){
        const div = document.createElement('div');
        div.className = 'cell';
        div.dataset.blockId = cells[y][x]; 
        gridElem.appendChild(div);
        cellDivs.push(div);
      }
    }

    function showColorful(){
      cellDivs.forEach(div=>{
        const id = parseInt(div.dataset.blockId);
        div.style.backgroundColor = id ? colors[id % colors.length] : 'white';
      });
    }
    function showMono(){
      cellDivs.forEach(div=>{
        const id = parseInt(div.dataset.blockId);
        div.style.backgroundColor = id ? '#666' : 'white';
      });
    }

    showMono();
    document.getElementById('btnColorful').addEventListener('click', showColorful);
    document.getElementById('btnMono').addEventListener('click', showMono);

    function generateCalendar() {
      const calGrid = document.getElementById('calGrid');
      const today = new Date();
      const year = today.getFullYear(), month = today.getMonth();
      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month+1, 0).getDate();
      const holidays = [];
      for (let i=0; i<firstDay; i++){
        const empty = document.createElement('div');
        empty.className = 'cal-cell';
        empty.style.visibility = 'hidden';
        calGrid.appendChild(empty);
      }
      for (let d=1; d<=daysInMonth; d++){
        const date = new Date(year, month, d);
        const cell = document.createElement('div');
        cell.className = 'cal-cell';
        if (date.getDay() === 0 || date.getDay() === 6) {
          cell.classList.add('weekend');
        }
        const key = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
        if (holidays.includes(key)) {
          cell.classList.add('weekend');
        }
        if (date.toDateString() === today.toDateString()) {
          cell.classList.add('today');
        }
        calGrid.appendChild(cell);
      }
    }
    generateCalendar();
  </script>
</body>
</html>
